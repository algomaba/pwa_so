<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Quiz AGE – Informática Básica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">

  <style>
    :root{
      --bg:#f4f6f8;--card:#ffffff;--text:#0f172a;--muted:#6b7280;
      --accent:#2563eb;--ok:#10b981;--danger:#ef4444
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:var(--text)}
    .wrap{max-width:900px;margin:auto;padding:16px}
    header{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:10px}
    h1{font-size:1.2rem;margin:0}
    button{background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:10px;font-weight:700;cursor:pointer}
    button.ghost{background:#fff;color:var(--text);border:1px solid #d1d5db}
    button:disabled{opacity:.5;cursor:not-allowed}
    #timer{font-weight:800;font-size:1.1rem}
    .card{background:var(--card);padding:14px;border-radius:14px;margin-top:14px}
    .question{border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin-bottom:12px}
    .question p{margin:0 0 8px;font-weight:700}
    label{display:block;padding:6px 8px;border-radius:8px}
    label.correct{background:rgba(16,185,129,.15);color:var(--ok)}
    label.incorrect{background:rgba(239,68,68,.15);color:var(--danger)}
    .footer{margin-top:10px;font-weight:700}
  </style>
</head>
<body>
<div class="wrap">
<header>
  <h1>Quiz AGE – Informática Básica</h1>
  <div>
    <span id="timer">30:00</span>
    <button id="startBtn">Iniciar</button>
    <button id="pauseBtn" class="ghost" disabled>Pausar</button>
    <button id="submitBtn">Enviar</button>
    <button id="resetBtn" class="ghost" style="display:none">Reiniciar</button>
  </div>
</header>

<main class="card">
  <form id="quiz"></form>
  <div class="footer">
    <div id="score"></div>
    <div id="details"></div>
  </div>
</main>

<div id="history" class="card">
  <h3>Historial de intentos</h3>
  <ul id="historyList"></ul>
  <button id="clearHistory" class="ghost">Borrar historial</button>
</div>
</div>

<script>
// ===== REGISTRO SERVICE WORKER =====

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('SW registrado', reg))
      .catch(err => console.error('SW error', err));
  });
}
</script>

// ===== PREGUNTAS (30) =====
const questionBank=[
{q:"¿Qué es el hardware?",o:["Programas","Dispositivos físicos","Datos"],c:1},
{q:"¿Qué es el software?",o:["Componentes físicos","Programas","Periféricos"],c:1},
{q:"Unidad de almacenamiento:",o:["CPU","Disco duro","Monitor"],c:1},
{q:"Función del SO:",o:["Solo redes","Gestiona recursos","Aumenta RAM"],c:1},
{q:"Periférico de entrada:",o:["Impresora","Teclado","Monitor"],c:1},
{q:"Procesos simultáneos:",o:["Overclock","Multitarea","Fragmentación"],c:1},
{q:"Memoria volátil:",o:["ROM","RAM","SSD"],c:1},
{q:"Sistema de archivos Windows:",o:["EXT4","NTFS","ReiserFS"],c:1},
{q:"NO es SO:",o:["Linux","Windows","UEFI"],c:2},
{q:"Ejecuta instrucciones:",o:["GPU","CPU","Fuente"],c:1},
{q:"Protege confidencialidad:",o:["Firewall","Cifrado","Proxy"],c:1},
{q:"Kernel es:",o:["Periférico","Núcleo SO","Malware"],c:1},
{q:"Transferencia archivos:",o:["FTP","SMTP","IMAP"],c:0},
{q:"Evita pérdida datos:",o:["Overclock","Backups","Fragmentación"],c:1},
{q:"Cifra datos y pide rescate:",o:["Adware","Ransomware","Spyware"],c:1},
{q:"Almacenamiento óptico:",o:["Blu-ray","SSD","RAM"],c:0},
{q:"Listar archivos Linux:",o:["ls","dir","cp"],c:0},
{q:"USB 3.0:",o:["480 Mbps","5 Gbps","10 Gbps"],c:1},
{q:"Direccionamiento lógico:",o:["Transporte","Red","Física"],c:1},
{q:"Hash es:",o:["Algoritmo irreversible","Archivo zip","Protocolo"],c:0},
{q:"Firewall hace:",o:["Cifra","Filtra tráfico","Optimiza CPU"],c:1},
{q:"Ventaja SSD:",o:["Más rápido","Más frágil","Velocidad constante"],c:0},
{q:"Evita alteración datos:",o:["Disponibilidad","Integridad","Confidencialidad"],c:1},
{q:"SO código abierto:",o:["macOS","Linux","Windows"],c:1},
{q:"Engaño al usuario:",o:["DDoS","Phishing","Ransomware"],c:1},
{q:"Más de 4 particiones:",o:["GPT","MBR","FAT32"],c:0},
{q:"Memoria rápida CPU:",o:["Disco","Caché","BIOS"],c:1},
{q:"Divide disco:",o:["Formateo","Particionamiento","Backup"],c:1},
{q:"Config red Windows:",o:["ipconfig","net use","chkdsk"],c:0},
{q:"Control de acceso:",o:["Restringe recursos","Backup","Correo"],c:0}
];

// ===== VARIABLES =====
let questions=[],started=false,paused=false;
let totalSeconds=1800,remaining=1800,interval;

const quiz=document.getElementById('quiz');
const timerEl=document.getElementById('timer');
const startBtn=document.getElementById('startBtn');
const pauseBtn=document.getElementById('pauseBtn');
const submitBtn=document.getElementById('submitBtn');
const resetBtn=document.getElementById('resetBtn');
const scoreEl=document.getElementById('score');
const detailsEl=document.getElementById('details');

// ===== UTILIDADES =====
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}
function updateTimer(){timerEl.textContent=Math.floor(remaining/60).toString().padStart(2,'0')+":"+(remaining%60).toString().padStart(2,'0')}

// ===== RENDER =====
function render(){
 quiz.innerHTML='';
 questions.forEach((q,i)=>{
  const d=document.createElement('div');d.className='question';
  d.innerHTML=`<p>${i+1}. ${q.q}</p>`+q.o.map((o,j)=>`<label><input type=radio name=q${i} value=${j}> ${o}</label>`).join('');
  quiz.appendChild(d);
 });
}

// ===== TIMER =====
function tick(){ if(remaining<=0){finish();return;} remaining--; updateTimer(); }

// ===== INICIAR =====
startBtn.onclick=()=>{
 if(started) return;
 questions=JSON.parse(JSON.stringify(questionBank));
 shuffle(questions);questions.forEach(q=>shuffle(q.o));
 render(); started=true; pauseBtn.disabled=false;
 interval=setInterval(tick,1000);
};

// ===== PAUSA =====
pauseBtn.onclick=()=>{
 if(!started) return;
 if(paused){interval=setInterval(tick,1000);pauseBtn.textContent='Pausar';}
 else{clearInterval(interval);pauseBtn.textContent='Reanudar';}
 paused=!paused;
};

// ===== FINALIZAR =====
function finish(){
 clearInterval(interval);
 let ok=0,empty=0;
 document.querySelectorAll('.question').forEach((d,i)=>{
  const sel=d.querySelector('input:checked');
  d.querySelectorAll('label').forEach(l=>l.classList.remove('correct','incorrect'));
  d.querySelectorAll('label')[questions[i].c].classList.add('correct');
  if(sel){ if(+sel.value===questions[i].c) ok++; else sel.parentElement.classList.add('incorrect'); }
  else empty++;
 });
 const penalty=empty*0.25;
 const final=Math.max(0,ok-penalty);
 scoreEl.textContent=`Resultado: ${final.toFixed(2)} / 30`;
 detailsEl.textContent=`Aciertos: ${ok} | Blancas: ${empty}`;
 saveResult({date:new Date().toLocaleString(),score:final.toFixed(2),ok,empty,time:(1800-remaining)});
 loadHistory(); resetBtn.style.display='inline-block';
}

submitBtn.onclick=()=>{if(confirm('¿Enviar examen?')) finish();};

// ===== RESET =====
resetBtn.onclick=()=>location.reload();

// ===== HISTORIAL =====
const historyList=document.getElementById('historyList');
const clearHistoryBtn=document.getElementById('clearHistory');

function saveResult(data){
 const h=JSON.parse(localStorage.getItem('quizHistory'))||[];
 h.push(data); localStorage.setItem('quizHistory',JSON.stringify(h));
}
function loadHistory(){
 const h=JSON.parse(localStorage.getItem('quizHistory'))||[];
 historyList.innerHTML='';
 h.slice().reverse().forEach(r=>{
  const li=document.createElement('li');
  li.textContent=`${r.date} — Nota ${r.score} — Aciertos ${r.ok} — Blancas ${r.empty}`;
  historyList.appendChild(li);
 });
}
clearHistoryBtn.onclick=()=>{if(confirm('¿Borrar historial?')){localStorage.removeItem('quizHistory');loadHistory();}};
loadHistory(); updateTimer();
</body>
</html>
